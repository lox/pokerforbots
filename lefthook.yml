# Lefthook configuration
# Ensures code quality before commits

pre-commit:
  parallel: true
  commands:
    # Run all Go tests with race detector - MUST PASS
    go-test:
      run: bin/gotestsum --format=standard-quiet -- -race -parallel 12 ./...
      fail_text: "Tests are failing! Fix all tests before committing."

    # Format Go code with golangci-lint
    go-fmt:
      glob: "**/*.go"
      run: bin/golangci-lint fmt {staged_files}
      fail_text: "Code formatting failed!"
      stage_fixed: true

    # Lint Go code with golangci-lint
    go-lint:
      run: bin/golangci-lint run ./...
      fail_text: "Linting failed! Fix all linter issues before committing."

    # Modernize analysis (auto-fix and restage changes)
    go-modernize:
      run: go run golang.org/x/tools/gopls/internal/analysis/modernize/cmd/modernize@latest -test -fix ./...
      fail_text: "Modernization issues detected! Auto-fixed where possible; review and commit."
      stage_fixed: true

    # Unused parameters analysis (auto-fix and restage changes)
    #go-unused-params:
    #  run: go run golang.org/x/tools/gopls/internal/analysis/unusedparams@latest -test -fix ./...
    #  fail_text: "Unused parameters detected! Auto-fixed where possible; review and commit."
    #  stage_fixed: true
